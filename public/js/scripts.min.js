$(document).ready(function() {
    $(".clickable_block:first").addClass("active"),
    //$(".block_after_click:not(:first)").hide(),
    $(".block_after_click").hide(),
    $(".clickable_block").click(function() {
        $(this).next(".block_after_click").slideToggle("slow"),
        $(this).toggleClass("active"),
        $(this).siblings(".clickable_block").removeClass("active")
    })
});


// $(document).ready(function() {
//     //$(".accordion .obj_slide:not(:first)").hide();
//     $(".block_login_panel").hide();
//     $(".clickable_block_login").click(function() {
//         $(".block_login_panel").slideToggle("fast" /*"slow"*/ );
//     });
// });

$(document).ready(function() { // Корзина add/remove/clear

    $(".add_to_cart").click(function()
    {
        var product_id = parseInt($(this).attr("data-id"));
        
        $.ajax({
            type: 'POST', 
            url: '/Basket/AddProduct', 
            data: {"product_id": product_id},
            success: function(){location.reload()}
        });
    });

    $(".remove_product").click(function()
    {
        var product_id = parseInt($(this).attr("data-id"));

        $.ajax({
            type: 'POST', 
            url: '/Basket/RemoveProduct',
            data: {"product_id": product_id},
            success: function(){location.reload()}
        });
    });

    $(".button_clear_all").click(function()
    {
        $.ajax({
            type: 'POST', 
            url: '/Basket/ClearBasket',
            success: function(){location.reload()}
            });
    });
});

$(document).ready(function() {
    $("#buttonLogin").click(function()
    {
        var formData = new FormData(document.forms.login);
        var client = new XMLHttpRequest();
        client.open('POST', '/account/login');
        client.setRequestHeader("X-Requested-With", "XMLHttpRequest");
        client.send(formData);
        client.onreadystatechange = function()
        {

            if (client.readyState != 4) return;
            if (client.status != 200) {
                //alert(client.status + ': ' + client.statusText);
                console.log(client.status + ': ' + client.statusText);
            } else {
                response = JSON.parse(client.responseText);
                if( response.success ) {
                    setTimeout(function() {location.reload();}, 2000 );
                }
            }
        }
    })
});

// Добавление товара в корзину
/* $(document).ready(function() {
    $(".add_to_cart").on("click", function() {
        var t = $(this).parent().parent().find(".product_name").text(),
            a = $(this).parent().parent().find("img").attr("src"),
            e = parseInt($(this).parent().parent().find(".product_price span").text()),
            i = parseInt($(this).attr("data-id")),
            s = parseInt($(".order").text());
        $(".order").text(++s);
        var r = parseInt($(".basket_total_price").text());
        $(".basket_total_price").text(r + e),

        console.log("Наименование товара :" + t);
        console.log("Адрес img:" + a);
        console.log("Цена продукта:" + e);
        console.log("ID продукта:" + i);
        console.log("Кол-во товаров в корзине:" + s);
        console.log("Общая стоимость товаров:" + (r + e));

        
        
        var tt = parseInt($(this).attr("data-id"));
        var ttt = $(".basket_box").find(".basket_mini_box_id-" + tt)[0];

        if (ttt) {
            console.log(tt, ttt);
            console.log('Такой товар уже есть в корзине!');
        } else {
            var o = $('<div class="basket_mini_box basket_mini_box_id-' + i + '"><img src="' + a + '" alt=""><div class="basket_mini_box_text"><h5>' + t + '</h5><a data-id="' + i + '" class="remove_product" href="#"><img src="img/close.png" alt=""></a><p class="star"><i class="fa fa-star" aria-hidden="true"></i><i class="fa fa-star" aria-hidden="true"></i><i class="fa fa-star" aria-hidden="true"></i><i class="fa fa-star" aria-hidden="true"></i><i class="fa fa-star-half-o" aria-hidden="true"></i></p><p class="product_price"><h6>1</h6>  x   $<span>' + e + "</span></p></div></div>");
            $(".basket_box").append(o), console.log("Товар добавлен!")
        }
    })
}); */

// Удаление товара из корзины
/* $(document).ready(function() {
    $(".basket_box").on("click", ".remove_product", function() {
        console.log(this), console.log("!");
        var t = parseInt($(this).attr("data-id"));
        console.log(t);
        var a = parseInt($(".order").text());
        $(".order").text(--a);
        var e = parseInt($(this).parent().find(".product_price span").text()),
        i = parseInt($(".basket_total_price").text());
        $(".basket_total_price").text(i - e),
        $(".basket_box").find(".basket_mini_box_id-" + t)[0].remove(),
        console.log("Товар удалён!")
    })
}); */

// Очистка корзины
/* $(document).ready(function() {
    $(".button_clear_all").on("click", function() {
        $(".order").text(0), $(".basket_total_price").text(0);
        var t = $(".basket_box").find(".basket_mini_box");
        console.log(t), t.remove(), console.log("Все товары удалены!")
    })
}); */

$(document).ready(function() {
    $("#slider-range").slider({
        min: 0,
        max: 1000,
        values: [52, 400],
        range: true,
        stop: function(event, ui) {
            var slider = $("#slider-range");
            $("#minCost").val($("#slider-range").slider("values", 0));
            $("#maxCost").val($("#slider-range").slider("values", 1));
        },
        slide: function(event, ui) {
            $("#minCost").val($("#slider-range").slider("values", 0));
            $("#maxCost").val($("#slider-range").slider("values", 1));
        }
    });
});